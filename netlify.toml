# Netlify configuration for Blazor WebAssembly (.NET 10)
# Proyecto: San Pablo Vet Clínic

[build]
  # Directorio base del proyecto
  base = "SPVetClinic"
  # Comando de build: instala .NET 10 SDK y publica
  command = """
    curl -sSL https://dot.net/v1/dotnet-install.sh -o dotnet-install.sh && \
    chmod +x dotnet-install.sh && \
    ./dotnet-install.sh --channel 10.0 --install-dir /opt/buildhome/.dotnet && \
    export DOTNET_ROOT=/opt/buildhome/.dotnet && \
    export PATH=$DOTNET_ROOT:$PATH && \
    dotnet --version && \
    dotnet publish -c Release -o output
  """
  # Directorio de publicación (relativo a base)
  publish = "output/wwwroot"

# Variables de entorno para el build
[build.environment]
  DOTNET_CLI_TELEMETRY_OPTOUT = "1"
  DOTNET_NOLOGO = "1"

# ============================================
# BRANCH DEPLOYS - Diferentes diseños
# ============================================
# main -> https://spvetclinic.netlify.app
# professional-design -> https://professional-design--spvetclinic.netlify.app
# minimalist-design -> https://minimalist-design--spvetclinic.netlify.app

# Contexto para rama professional-design
[context.professional-design]
  command = """
    curl -sSL https://dot.net/v1/dotnet-install.sh -o dotnet-install.sh && \
    chmod +x dotnet-install.sh && \
    ./dotnet-install.sh --channel 10.0 --install-dir /opt/buildhome/.dotnet && \
    export DOTNET_ROOT=/opt/buildhome/.dotnet && \
    export PATH=$DOTNET_ROOT:$PATH && \
    dotnet publish -c Release -o output
  """

# Contexto para rama minimalist-design  
[context.minimalist-design]
  command = """
    curl -sSL https://dot.net/v1/dotnet-install.sh -o dotnet-install.sh && \
    chmod +x dotnet-install.sh && \
    ./dotnet-install.sh --channel 10.0 --install-dir /opt/buildhome/.dotnet && \
    export DOTNET_ROOT=/opt/buildhome/.dotnet && \
    export PATH=$DOTNET_ROOT:$PATH && \
    dotnet publish -c Release -o output
  """

# ============================================
# SPA ROUTING
# ============================================
# Redirige todas las rutas a index.html (necesario para Blazor)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# ============================================
# HEADERS DE SEGURIDAD Y CACHÉ
# ============================================
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"

# Cache agresivo para archivos del framework (inmutables por fingerprint)
[[headers]]
  for = "/_framework/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Cache para contenido estático
[[headers]]
  for = "/_content/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=604800"
